$(document).ready(function(){function e(e,t,n){var i=[];for(var a in e)i.push('<input type="checkbox" name="SMFilter" value="'+e[a]+'">'+e[a]+"<br><i>&nbsp; &nbsp; &nbsp;&#40;cited "+t.SMCount[e[a]]+" times&#41;</i></input>");$("#SubjectiveMarkers").html(i.join("<br />")),$("#SubjectiveMarkers").on("click",function(){o(t,n),$(".pause").hide(),$(".play").show(),u(t,n)}),$("#checkAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!0}),o(t,n),$(".pause").hide(),$(".play").show(),u(t,n)}),$("#uncheckAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!1}),o(t,n)}),$("#resetMapBtn").click(function(){w.setView([48.876,2.36],15)})}function o(e,o){S=[],$("input:checkbox[name=SMFilter]:checked").each(function(){S.push($(this).val())}),$("#checkedNum").html(S.length+" categories are checked"),n(e,o)}function t(e){var o=[],t=[],n=[],i=[],a={};for(var c in e.features){var r=e.features[c].properties;void 0===t[r.Page]&&(o.push(r.Page),t[r.Page]=1),void 0===i[r.SM]&&(n.push(r.SM),i[r.SM]=1),void 0===a[r.SM]?a[r.SM]=1:a[r.SM]+=1}return{SMs:n,pages:o.sort(function(e,o){return e-o}),SMCount:a}}function n(e,o,t,n){console.log(e),console.log(o),console.log(t),console.log(n),w.hasLayer(v)&&w.removeLayer(v),v=L.geoJson(o,{filter:function(e){return t?e.properties.Page==t?!0:!1:-1!==$.inArray(e.properties.SM,S)?!0:!1},pointToLayer:function(e,o){return L.circle(o,200,{fillColor:i(e.properties.SM),color:i(e.properties.SM),weight:4,clickable:!0,fillOpacity:.2}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#000000"})},mouseout:function(){this.closePopup(),this.setStyle({color:i(e.properties.SM)})},click:m})}}).addTo(w),a()}function i(){return"#CC2B0A"}function a(){v.eachLayer(function(e){var o=e.feature.properties,t=100,n="<i><b>"+o.SM+"</b></i> <br>"+o.Address+"<br>page "+o.Page;e.setRadius(t),e.bindPopup(n,{offset:new L.Point(0,10)}),e.options.color=i(o.SM),e.options.fillColor=i(o.SM)})}function c(e,o,t){var i=L.control({position:"bottomright"});i.onAdd=function(){var i=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(i,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(i).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}).on("input change",function(){n(o,t,this.value),$(".temporal-legend").text("On page "+this.value)}),i},i.addTo(w),h(e[0])}function r(t,n){$(".pause").hide(),$(".play").click(function(){$(".pause").show(),$(".play").hide(),w.setView([48.876,2.357],15),clearInterval(b),k=250,l(t,n,k),e(t.SMs,t,n),o()}),$(".pause").click(function(){$(".pause").hide(),$(".play").show(),u(t,n,k)}),$(".step").click(function(){u(),$(".pause").hide(),$(".play").show(),p(t,n)}),$(".back").click(function(){u(),$(".pause").hide(),$(".play").show(),s(t,n)}),$(".back-full").click(function(){u(),$(".pause").hide(),$(".play").show(),d(t,n)}),$(".step-full").click(function(){$(".pause").hide(),$(".play").show(),f(t,n)}),$(".faster").click(function(){k>100?(k-=100,clearInterval(b),l(t,n,k)):k=250}),$(".slower").click(function(){1e3>k?(k+=100,clearInterval(b),l(t,n,k),console.log(k)):k=250})}function l(e,o,t){b=setInterval(function(){p(e,o)},t)}function u(e,o,t){t=0,clearInterval(b)}function s(e,o,t){M>9&&M--,n(e,o,M,t),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function p(e,o,t){238>M&&M++,n(e,o,M,t),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function f(e,o){M=238,n(e,o,M),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function d(e,o){M=9,n(e,o,M),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function h(e){var o=L.control({position:"bottomright"});o.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},o.addTo(w),$(".temporal-legend").text("On page "+e)}function g(e){x._loaded&&x.setZoom(e.target.getZoom()+1)}function m(e){y.style.top=~~e.containerPoint.y-100+"px",y.style.left=~~e.containerPoint.x-100+"px",x.setView(e.latlng,w.getZoom()+0,!0)}var v,k,b,y=document.getElementById("zoomlens"),S=[],M=9;L.mapbox.accessToken="pk.eyJ1IjoiZGVhbm9sc2VuMSIsImEiOiJ1dkxBdm9FIn0.kapau_lUukKIE93Y8I0A9g";var w=L.mapbox.map("map","deanolsen1.l6h0h2j6",{zoomControl:!1,attributionControl:!1});w.setView([48.876,2.357],15),new L.Control.Zoom({position:"topright"}).addTo(w),$.getJSON("data/Locationsv4.geojson").done(function(i){var a=t(i);n(a,i),c(a.pages,a,i),e(a.SMs,a,i),o(a,i),r(a,i)}).fail(function(){alert("There has been a problem loading the data.")});var x=L.mapbox.map("zoommap","deanolsen1.l4i434a2",{fadeAnimation:!1,zoomControl:!1,clickable:!0,attributionControl:!1});w.on("click",m),w.on("zoomend",g)});