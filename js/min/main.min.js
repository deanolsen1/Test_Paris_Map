function SizeMe(e){$("body").height($(window).outerHeight()-40),$("body").width($(window).outerWidth());var o=($("body").width(),$("body").height(),38),t=151,n=49,i=30;$("#map").height($("body").height()-$("#map").offset().top),$("#menu").height($("#map").height()-o),$("#vcr-controls").css("top",$("#map").offset().top+$("#map").height()-n-i+"px"),$("#SubjectiveMarkers").height($("#menu").height()-t),e.invalidateSize()}$(document).ready(function(){function e(e,t,n){var i=[];for(var a in e)i.push('<input type="checkbox" name="SMFilter" value="'+e[a]+'">'+e[a]+"<br><i>&nbsp; &nbsp; &nbsp;&#40;cited "+t.SMCount[e[a]]+" times&#41;</i></input>");$("#SubjectiveMarkers").html(i.join("<br />")),$("#SubjectiveMarkers").on("click",function(){o(t,n),$(".pause").hide(),$(".play").show(),u(t,n)}),$("#checkAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!0}),o(t,n),$(".pause").hide(),$(".play").show(),u(t,n)}),$("#uncheckAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!1}),o(t,n)}),$("#resetMapBtn").click(function(){S.setView([48.876,2.36],15)})}function o(e,o){y=[],$("input:checkbox[name=SMFilter]:checked").each(function(){y.push($(this).val())}),$("input:checkbox[name=SMFilter]").not(":checked").each(function(){$("."+n($(this).val())).remove()}),$("#checkedNum").html(y.length+" categories are checked"),i(e,o)}function t(e){var o=[],t=[],n=[],i=[],a={};for(var r in e.features){var c=e.features[r].properties;void 0===t[c.Page]&&(o.push(c.Page),t[c.Page]=1),void 0===i[c.SM]&&(n.push(c.SM),i[c.SM]=1),void 0===a[c.SM]?a[c.SM]=1:a[c.SM]+=1}return{SMs:n,pages:o.sort(function(e,o){return e-o}),SMCount:a}}function n(e){return e.replace(/\s/g,"").replace(/[^a-zA-Z 0-9]+/g,"").toLowerCase()}function i(e,o,t,i,c){console.log(e),console.log(o),console.log(i),console.log(c),S.hasLayer(g)&&S.removeLayer(g),c&&$("#dvAllMyZooms").empty();var l=[];g=L.geoJson(o,{filter:function(e){return t?e.properties.Page==t?!0:!1:-1!==$.inArray(e.properties.SM,y)?!0:!1},pointToLayer:function(e,o){l.push([o.lat,o.lng]);var t=L.circle(o,200,{fillColor:a(e.properties.SM),color:a(e.properties.SM),stroke:!1,weight:4,clickable:!0,fillOpacity:0,opacity:0}),i=S.latLngToContainerPoint(o);i.latlng=o;var r=n(e.properties.SM),c=function(e){var o="zoomlens"+b,i="olay"+b,a="zoommap"+b++;$("#dvAllMyZooms").append("<div id='"+o+"' class='zoomlens "+n(r)+" overlay'><div id='"+i+"' class='overlay rotater'><div class='overlay rotater'><div id='"+a+"' class='zoommap overlay'></div></div></div><div id='border' class='overlay'></div></div>");var c=document.getElementById(o),l=L.mapbox.map(a,"deanolsen1.l4i434a2",{fadeAnimation:!1,zoomControl:!1,clickable:!0,attributionControl:!1});zoomIt=function(){l._loaded&&l.setZoom(S.getZoom()+1)},updateLens=function(e){c.style.top=e.y-10+"px",c.style.left=e.x-10+"px",l.setView(e.latlng,S.getZoom()+0,!0)},S.on("zoomend",function(){updateLens(e),zoomIt(e)}),S.on("dragend",function(){updateLens(e),zoomIt(e)}),updateLens(e),zoomIt(e),$("#"+o).on({mouseover:function(){t.openPopup()},mouseout:function(){}})};return c(i),t}}).addTo(S),r(),l.length>0&&S.fitBounds(l)}function a(){return"#CC2B0A"}function r(){g.eachLayer(function(e){var o=e.feature.properties,t=100,n="<i><b>"+o.SM+"</b></i> <br>"+o.Address+"<br>page "+o.Page;e.setRadius(t),e.bindPopup(n,{offset:new L.Point(0,10)}),e.options.color=a(o.SM),e.options.fillColor=a(o.SM)})}function c(e,o,t){var n=L.control({position:"bottomright"});n.onAdd=function(){var n=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(n,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(n).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}).on("input change",function(){i(o,t,this.value),$(".temporal-legend").text("On page "+this.value)}),n},n.addTo(S),f(e[0])}function l(t,n){$(".pause").hide(),$(".play").click(function(){$(".pause").show(),$(".play").hide(),S.setView([48.876,2.357],15),clearInterval(v),M=250,s(t,n,M),e(t.SMs,t,n),o()}),$(".pause").click(function(){$(".pause").hide(),$(".play").show(),u(t,n,M)}),$(".step").click(function(){u(),$(".pause").hide(),$(".play").show(),d(t,n)}),$(".back").click(function(){u(),$(".pause").hide(),$(".play").show(),p(t,n)}),$(".back-full").click(function(){u(),$(".pause").hide(),$(".play").show(),m(t,n)}),$(".step-full").click(function(){$(".pause").hide(),$(".play").show(),h(t,n)}),$(".faster").click(function(){M>100?(M-=100,clearInterval(v),s(t,n,M)):M=250}),$(".slower").click(function(){1e3>M?(M+=100,clearInterval(v),s(t,n,M),console.log(M)):M=250})}function s(e,o,t){v=setInterval(function(){d(e,o)},t)}function u(e,o,t){t=0,clearInterval(v)}function p(e,o,t){k>9&&k--,i(e,o,k,t,!0),$("input[type=range]").val(k),$(".temporal-legend").text("On Page "+k)}function d(e,o,t){238>k&&k++,console.log(t),i(e,o,k,t,!0),$("input[type=range]").val(k),$(".temporal-legend").text("On Page "+k)}function h(e,o,t){k=238,i(e,o,k,t,!0),$("input[type=range]").val(k),$(".temporal-legend").text("On Page "+k)}function m(e,o,t){k=9,i(e,o,k,t,!0),$("input[type=range]").val(k),$(".temporal-legend").text("On Page "+k)}function f(e){var o=L.control({position:"bottomright"});o.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},o.addTo(S),$(".temporal-legend").text("On page "+e)}var g,v,b=0,y=[],k=9,M=100;L.mapbox.accessToken="pk.eyJ1IjoiZGVhbm9sc2VuMSIsImEiOiJ1dkxBdm9FIn0.kapau_lUukKIE93Y8I0A9g";var S=L.mapbox.map("map","deanolsen1.l6h0h2j6",{zoomControl:!1,attributionControl:!1});S.setView([48.876,2.357],15),$(window).resize(function(){$("#vcr-controls").css("margin-right","0px"),SizeMe(S)}),SizeMe(S),new L.Control.Zoom({position:"topright"}).addTo(S),$.getJSON("data/Locationsv4.geojson").done(function(n){var a=t(n);i(a,n),c(a.pages,a,n),e(a.SMs,a,n),o(a,n),l(a,n)}).fail(function(){alert("There has been a problem loading the data.")});document.getElementById("zoomlens"),L.mapbox.map("zoommap","deanolsen1.l4i434a2",{fadeAnimation:!1,zoomControl:!1,clickable:!0,attributionControl:!1})});